## Count + List --

Bilkul, main aapko **Terraform mein `count` aur `list` ka use** ekdam ache se samjhata hoon, thoda sa detailed tarike se. Pehle `count` aur `list` ko alag se samajhte hain, phir unhe ek practical example ke through dekhte hain.

### Terraform `count` aur `list` kya hai?

1. **`count`**:  
   Ye ek **meta-argument** hai jo Terraform resources ko dynamically create karne ke liye use hota hai. Agar aapko ek hi resource ka multiple copies chahiye (jaise multiple VMs, storage accounts, etc.), toh `count` ka use karte hain.

   - Agar aap `count` ke value ko `N` set karte hain, toh Terraform `N` instances us resource ka create karega.
   - Aap resource ke har instance ko uniquely identify karne ke liye `count.index` ka use karte hain.

   **Example:**
   Agar aapko 3 VMs create karni hain, toh aap `count` ko 3 set karenge. Terraform automatically 3 VMs create karega, har ek VM ka naam thoda different hoga, jaise `vm1`, `vm2`, `vm3`.

2. **`list`**:
   Ye ek collection data type hai, jisme ordered elements hote hain. List mein aap multiple values store kar sakte hain, aur unhe index ke through access kar sakte hain.

   - Aap list ka use variables mein values store karne ke liye karte hain. Example ke liye, ek list of VM names rakhna, ya phir ek list of IP addresses.
   - Aap Terraform mein `list(string)` ya `list(number)` types define kar sakte hain.

### Example: Azure Mein Multiple Virtual Machines Create Karna Using `count` and `list`

Chalo, ab is concept ko ek practical example se samajhte hain.

#### Step 1: Terraform Configuration File Likho

```hcl
# Azure provider ko configure karna
provider "azurerm" {
  features {}
}

# List variable for VM names
variable "vm_names" {
  type    = list(string)  # Yeh ek list hai jisme string type values hain
  default = ["vm1", "vm2", "vm3"]  # Yeh list 3 VMs ke names hai
}

# Resource Group Creation
resource "azurerm_resource_group" "example" {
  name     = "example-resources"  # Resource group ka naam
  location = "East US"            # Location ka naam (Azure region)
}

# Looping over VM names to create multiple VMs using `count`
resource "azurerm_virtual_machine" "example_vm" {
  count               = length(var.vm_names)  # `count` ka use kar rahe hain jitne VMs hum create karenge
  name                = var.vm_names[count.index]  # VM ka naam list ke index ke basis pe set ho raha hai
  location            = azurerm_resource_group.example.location  # Resource group ke location ko use kar rahe hain
  resource_group_name = azurerm_resource_group.example.name
  size                = "Standard_B1ms"  # VM size (simple size example)

  # Network Interface ID
  network_interface_ids = [
    azurerm_network_interface.example[count.index].id  # Har VM ko apni unique NIC milegi
  ]

  # OS Profile (Windows VM ka example)
  os_profile {
    computer_name  = var.vm_names[count.index]  # VM ka naam
    admin_username = "adminuser"                 # Admin username
    admin_password = "password123!"              # Admin password
  }

  os_profile_windows_config {
    provision_vm_agent = true  # VM Agent ko provision karna
  }
}

# Network Interface Creation for each VM (Har VM ka apna NIC)
resource "azurerm_network_interface" "example" {
  count               = length(var.vm_names)  # `count` ka use kar rahe hain
  name                = "nic-${var.vm_names[count.index]}"  # NIC ka naam bhi unique ho raha hai
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  ip_configuration {
    name                          = "internal"
    private_ip_address_allocation = "Dynamic"  # Private IP dynamically assign hoga
    subnet_id                    = azurerm_subnet.example.id  # Subnet ke ID ko use karenge
  }
}

# Virtual Network Creation
resource "azurerm_virtual_network" "example" {
  name                = "example-vnet"
  address_space       = ["10.0.0.0/16"]  # VNet ka address space
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name
}

# Subnet Creation
resource "azurerm_subnet" "example" {
  name                 = "example-subnet"
  resource_group_name  = azurerm_resource_group.example.name
  virtual_network_name = azurerm_virtual_network.example.name
  address_prefixes     = ["10.0.1.0/24"]  # Subnet ka IP range
}
```

#### Explanation of Key Parts

1. **`variable "vm_names"`**:
   - Ye ek **list** hai jisme 3 VMs ke names diye gaye hain: `["vm1", "vm2", "vm3"]`.
   - Hum `count` ka use karenge taaki har VM ko ek unique name mile.

2. **`count = length(var.vm_names)`**:
   - `length(var.vm_names)` se humein ye pata chal jaata hai ki kitne VMs create karne hain. Is case mein, ye 3 VMs hain, kyunki list mein 3 names hain.
   - `count.index` ko use karke, hum har VM ko ek unique name assign karenge jaise `vm1`, `vm2`, `vm3`.

3. **`network_interface_ids = [azurerm_network_interface.example[count.index].id]`**:
   - Har VM ko apni unique network interface (NIC) chahiye. Isliye hum `count.index` ka use karte hue har VM ko alag NIC de rahe hain.

4. **VM Creation**: 
   - `os_profile` mein `computer_name` ko dynamic tarike se list se assign kar rahe hain, taaki har VM ka naam `vm1`, `vm2`, etc. ho.
   - `admin_username` aur `admin_password` ko static rakha hai for simplicity, lekin aapko production environment mein yeh securely handle karna chahiye.

5. **Network Interface Creation**: 
   - Har VM ke liye ek network interface create ho rahi hai jo dynamically `count.index` ke through assign ho rahi hai.

6. **Virtual Network aur Subnet Creation**:
   - Virtual network aur subnet create kar rahe hain, jisme sabhi VMs ko allocate karenge.

#### Step 2: Apply Terraform Configuration

1. **Initialize Terraform**:
   Pehle Terraform ko initialize karo, jisse providers aur modules load ho sakein.
   ```bash
   terraform init
   ```

2. **Plan**:
   Plan command se configuration ka review kar sakte ho, jisme pata chalega ki kya changes hone wale hain.
   ```bash
   terraform plan
   ```

3. **Apply**:
   Apply command se resources create ho jayenge.
   ```bash
   terraform apply
   ```

#### Output
Agar `vm_names` mein `"vm1", "vm2", "vm3"` hain, toh 3 virtual machines banengi:

- `vm1`, `vm2`, `vm3`
- Har VM ka apna network interface aur subnet hoga.

### Conclusion

- **`count`** ka use karke hum multiple resources create kar sakte hain.
- **`list`** mein multiple values store karke unhe dynamically access kar sakte hain.
- Har resource ko uniquely identify karne ke liye `count.index` ka use hota hai.

Agar aapko koi aur confusion ho, toh batana!
